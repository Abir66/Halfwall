<style>

    .middle .group-header{
        background: var(--color-white);
        border-radius: var(--card-border-radius);
        margin: 0 0;
        margin-bottom: 1.5rem;
        font-size: 0.85rem;
        line-height: 1.5;
    }

    .middle .group-header .group-photo{
        width: 100%;
    }

    .middle .group-header .group-photo img{
        width: 100%;
        aspect-ratio: 16/6;
        object-fit: cover;
    }

    .middle .group-header .group-info{
        padding: 1rem;
    }

    .middle .group-header .group-name{
        font-size: 1.2rem;
        font-weight: 500;
    }

    .group-submenu{
        padding: 0 1rem;
        display: flex;
        align-items: center;
        justify-content: start;
        gap: 1rem;
    }

    .group-submenu .submenu-item{
        margin-bottom: 1rem;
        font-size: 0.85rem;
        font-weight: 500;
        color: var(--color-black);
        text-decoration: none;
        cursor: pointer;
    }

    .group-submenu .active{
        color: var(--color-primary);
        border-bottom: 1px solid var(--color-primary);
    }

    .group-submenu .submenu-item:hover{
        opacity: 0.8;
    }

    .group-submenu .group-join-button{
        margin-bottom: 1rem;
        font-size: 0.85rem;
        font-weight: 500;
        margin-left: auto;
        
    }

</style>



<div class="group-header">

    <div class="group-photo">
        <img src="<%=group.COVER_PHOTO%>"  alt="groupphoto">
    </div>
    
    <div class="group-info">
        <h3 class = "group-name"><%= group.GROUP_NAME %> </h3>
        <div class="group-details">
            <p class="text-muted"><%= group.GROUP_PRIVACY %> Group | <%= group.GROUP_MEMBER_COUNT %> members</p>
        </div>
    </div>

    <div class="group-submenu">
        <a href="/groups/group_id=<%= group.GROUP_ID%>/posts"><div class="submenu-item  <% if (data.active === 'Posts') { %> active <% } %>">Posts</div></a>
        <a href="/groups/group_id=<%= group.GROUP_ID%>/about"><div class="submenu-item  <% if (data.active === 'About') { %> active <% } %>">About</div></a>
        <a href="/groups/group_id=<%= group.GROUP_ID%>/members"><div class="submenu-item  <% if (data.active === 'Members') { %> active <% } %>">Members</div></a>

        <% if (isAdmin) { %><div class="submenu-item" data-bs-toggle="modal" data-bs-target="#delete_group_modal">Delete Group</div><% } %>
        <% if (isAdmin) { %><a href="/groups/group_id=<%= group.GROUP_ID%>/edit-group"><div class="submenu-item" >Edit Group</div></a><% } %>

        
        <% if (isMember) { %>
            <div class="group-join-button btn btn-blank" data-bs-toggle="modal" data-bs-target="#leave-group-modal">Leave</div> 
        <% } else if (isPending) { %>
            <div class="group-join-button btn btn-blank" data-bs-toggle="modal" data-bs-target="#cancel-pending-group-modal">Pending</div> 
        <% } else { %> 
            <div class="group-join-button btn btn-primary" onclick="joinGroup(<%= group.GROUP_ID%>)">Join</div> 
        <% } %>
         
         
    </div>

    

    
  <!-- Modal delete group-->
  <% if (isAdmin) { %>
  <div class="modal fade" id="delete_group_modal" tabindex="-1" aria-labelledby="delete_group_modalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="delete-group-modal-label">Delete Group</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p style="font-size: 1.2rem; font-weight: 500;">Are you sure you want to delete this group "<%= group.GROUP_NAME %>"?</p>
          <p style="font-size: 0.8rem; color: red;">This action cannot be undone</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="deleteGroup(<%=group.GROUP_ID%>)">Delete</button>
        </div>
      </div>
    </div>
  </div>
  <% } %>


<!-- Modal leave group-->
<div class="modal fade" id="leave-group-modal" tabindex="-1" aria-labelledby="leave-group-modalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="leave-group-modal-label">Leave Group</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p style="font-size: 1.2rem; font-weight: 500;">Are you sure you want to Leave this group "<%= group.GROUP_NAME %>"?</p>
          <p style="font-size: 0.8rem; color: red;">This action cannot be undone</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="leaveGroup(<%= group.GROUP_ID%>)">Leave</button>
        </div>
      </div>
    </div>
</div>



<!-- Modal cancel pending join request-->
<div class="modal fade" id="cancel-pending-group-modal" tabindex="-1" aria-labelledby="cancel-pending-group-modalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancel-pending-group-modal-label">Leave Group</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p style="font-size: 1.2rem; font-weight: 500;">Are you sure you want to cancel your join request to this group "<%= group.GROUP_NAME %>"?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="leaveGroup(<%= group.GROUP_ID%>)">Cancel join request</button>
        </div>
      </div>
    </div>
</div>



<!-- Only admin -->
<div class="modal fade" id="only-admin-group-modal" tabindex="-1" aria-labelledby="only-admin-group-modalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="only-admin-group-modal-label">Leave Group</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p style="font-size: 1.2rem; font-weight: 500;">You cannot leave this group "<%= group.GROUP_NAME %>" because you are the only admin of it. Make someone else admin first or delete the group.</p>
        </div>
      </div>
    </div>
</div>





</div>



<script>
    async function deleteGroup(group_id){
        // send axios request to delete group
        const response = await axios.post(`/groups/group_id=${group_id}/delete-group`);

        if (response.data === 'success') window.location.replace("/groups");
        
        // get the modal
        let modal = document.getElementById('delete_group_modal');
        modal = bootstrap.Modal.getInstance(modal)
        modal.hide();
    }


    async function joinGroup(group_id){
        const response = await axios.post(`/groups/group_id=${group_id}/join-group`);

        if (response.data === 'success') window.location.reload();
        
        // get the modal
        let modal = document.getElementById('delete_group_modal');
        modal = bootstrap.Modal.getInstance(modal)
        modal.hide();
    }


    async function leaveGroup(group_id){
        const response = await axios.post(`/groups/group_id=${group_id}/leave-group`);
        console.log(response.data);
        if (response.data === 'success') window.location.reload();
        else if(response.data === 'only admin'){
            // get the modal
            const only_admin_modal = new bootstrap.Modal(document.getElementById('only-admin-group-modal'), {});
            only_admin_modal.show();
        }
        // get the modal
        let modal = document.getElementById('leave-group-modal');
        modal = bootstrap.Modal.getInstance(modal)
        modal.hide();
        
    }


</script>