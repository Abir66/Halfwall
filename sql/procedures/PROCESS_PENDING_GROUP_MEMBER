CREATE OR REPLACE PROCEDURE "PROCESS_PENDING_GROUP_MEMBER" (Q_GROUP_ID IN NUMBER, Q_USER_ID IN NUMBER, ACTION IN VARCHAR2, RESULT OUT VARCHAR2)
AS
BEGIN
	
	DELETE FROM GROUP_PENDING
	WHERE GROUP_ID = Q_GROUP_ID AND USER_ID = Q_USER_ID;
	
	IF UPPER(ACTION) = 'ACCEPT' THEN
		INSERT INTO GROUP_MEMBERS(GROUP_ID, USER_ID, TIMESTAMP)
		VALUES(Q_GROUP_ID, Q_USER_ID, CURRENT_TIMESTAMP);
	END IF;
	
	RESULT := 'SUCCESS';
	
	EXCEPTION
    WHEN DUP_VAL_ON_INDEX THEN
        RESULT := 'Group member already exists';
    WHEN OTHERS THEN
        RESULT := 'Please fill up the fields correctly';

END;