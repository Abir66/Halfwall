CREATE OR REPLACE PROCEDURE "PROCESS_FOLLOW_REQUEST" (Q_FOLLOWER_ID IN NUMBER, Q_FOLLOWEE_ID IN NUMBER, ACTION IN VARCHAR2, RESULT OUT VARCHAR2)
AS

	CNT NUMBER;

BEGIN
	SELECT COUNT(*) INTO CNT FROM FOLLOW_REQUESTS
	WHERE FOLLOWER_ID = Q_FOLLOWER_ID AND FOLLOWEE_ID = Q_FOLLOWEE_ID;
	
	IF CNT < 1 THEN
		RESULT := 'REQUEST ALREADY REMOVED';
		RETURN;
	END IF;
	
	DELETE FROM FOLLOW_REQUESTS
	WHERE FOLLOWER_ID = Q_FOLLOWER_ID AND FOLLOWEE_ID = Q_FOLLOWEE_ID;
	
	IF UPPER(ACTION) = 'ACCEPT' THEN
		INSERT INTO FOLLOWS(FOLLOWEE_ID, FOLLOWER_ID, TIMESTAMP)
		VALUES(Q_FOLLOWEE_ID, Q_FOLLOWER_ID, CURRENT_TIMESTAMP);
	END IF;
	
	RESULT := 'success';

EXCEPTION
   WHEN DUP_VAL_ON_INDEX THEN
       RESULT := 'already following';
   WHEN OTHERS THEN
       RESULT := 'Please fill up the fields correctly';
END;