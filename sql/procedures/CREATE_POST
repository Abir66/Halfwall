CREATE OR REPLACE PROCEDURE "CREATE_POST" (Q_USER_ID IN NUMBER, Q_GROUP_ID IN NUMBER, Q_TEXT IN VARCHAR2, RESULT OUT VARCHAR2, R_POST_ID OUT NUMBER)
AS
	
	GROUP_EXISTS NUMBER;
	Q_GROUP_MEMBERSHIP VARCHAR2(255);

BEGIN
	
	R_POST_ID := -1;
	
	-- CHECK IF GROUP EXISTS
	SELECT COUNT(*) INTO GROUP_EXISTS FROM GROUPS WHERE GROUP_ID = Q_GROUP_ID;
	IF GROUP_EXISTS = 0 THEN
		RESULT := 'Group does not exist';
		RETURN;
	END IF;
			
	-- IF GROUP POST THEN CHECK IF MEMBER
	IF Q_GROUP_ID > 100 THEN	
		Q_GROUP_MEMBERSHIP := GROUP_MEMBERSHIP_STATUS(Q_GROUP_ID, Q_USER_ID);
		
		IF (Q_GROUP_MEMBERSHIP <> 'ADMIN' AND Q_GROUP_MEMBERSHIP <> 'MEMBER') THEN
			RESULT := 'Group membership invalid';
			RETURN;
		END IF;
		
	END IF;
	
	R_POST_ID := POST_SEQ.NEXTVAL;
	INSERT INTO POSTS(POST_ID, USER_ID, GROUP_ID, TEXT, TIMESTAMP)
	VALUES(R_POST_ID, Q_USER_ID, Q_GROUP_ID, Q_TEXT, CURRENT_TIMESTAMP);
	RESULT := 'success';
	
	
		
EXCEPTION
    WHEN OTHERS THEN
        RESULT := 'something went wrong';
		
		
END;