CREATE OR REPLACE PROCEDURE "LEAVE_GROUP" (Q_GROUP_ID IN NUMBER, Q_USER_ID IN NUMBER, RESULT OUT VARCHAR2)
AS
	MEMBERSHIP VARCHAR2(255);
	ADMIN_COUNT NUMBER;
	
BEGIN

	MEMBERSHIP := GROUP_MEMBERSHIP_STATUS(Q_GROUP_ID, Q_USER_ID);
	IF MEMBERSHIP = 'ADMIN' THEN
			SELECT COUNT(*) INTO ADMIN_COUNT FROM GROUP_MEMBERS
			WHERE GROUP_ID = Q_GROUP_ID AND STATUS = 'ADMIN';
			
			IF ADMIN_COUNT = 1 THEN
				RESULT := 'only admin';
				RETURN;
			END IF;	
	END IF;
	
	DELETE FROM GROUP_MEMBERS
	WHERE GROUP_ID = Q_GROUP_ID AND USER_ID = Q_USER_ID;
	
	RESULT := 'success';

EXCEPTION
	WHEN OTHERS THEN
		RESULT := 'Something went wrong';
END;