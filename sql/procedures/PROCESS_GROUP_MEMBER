CREATE OR REPLACE PROCEDURE "PROCESS_GROUP_MEMBER" (Q_GROUP_ID IN NUMBER, Q_ADMIN_ID IN NUMBER, Q_USER_ID IN NUMBER, ACTION IN VARCHAR2, RESULT OUT VARCHAR2)
AS
BEGIN
	-- First check if the admin is valid
	IF GROUP_MEMBERSHIP_STATUS(Q_GROUP_ID, Q_ADMIN_ID) <> 'ADMIN' THEN
		RESULT := 'adminship not valid';
		RETURN;
	END IF;
	
	IF ACTION = 'accept-pending' THEN
		UPDATE GROUP_MEMBERS SET STATUS = 'MEMBER', TIMESTAMP = CURRENT_TIMESTAMP WHERE GROUP_ID = Q_GROUP_ID AND USER_ID = Q_USER_ID AND STATUS = 'PENDING';
		
	ELSIF ACTION = 'remove-pending' THEN
		DELETE FROM GROUP_MEMBERS WHERE GROUP_ID = Q_GROUP_ID AND USER_ID = Q_USER_ID AND STATUS = 'PENDING';
		
	ELSIF ACTION = 'make-admin' THEN
		UPDATE GROUP_MEMBERS SET STATUS = 'ADMIN' WHERE GROUP_ID = Q_GROUP_ID AND USER_ID = Q_USER_ID AND STATUS = 'MEMBER';
		
	ELSIF ACTION = 'remove-member' THEN
		DELETE FROM GROUP_MEMBERS WHERE GROUP_ID = Q_GROUP_ID AND USER_ID = Q_USER_ID AND STATUS = 'MEMBER';
		
	ELSIF ACTION = 'remove-admin' THEN
		UPDATE GROUP_MEMBERS SET STATUS = 'MEMBER' WHERE GROUP_ID = Q_GROUP_ID AND USER_ID = Q_USER_ID AND STATUS = 'ADMIN';

	END IF;
	
	RESULT := 'success';
	
	EXCEPTION
    WHEN OTHERS THEN
        RESULT := 'Something went wrong';
	
END;