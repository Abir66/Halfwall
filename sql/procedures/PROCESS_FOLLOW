CREATE OR REPLACE PROCEDURE "PROCESS_FOLLOW" (Q_FOLLOWER_ID IN NUMBER, Q_FOLLOWEE_ID IN NUMBER, ACTION IN VARCHAR2, RESULT OUT VARCHAR2)
AS

BEGIN
	
	IF UPPER(ACTION) = 'START-FOLLOW' THEN
		INSERT INTO FOLLOWS(FOLLOWER_ID, FOLLOWEE_ID, STATUS, TIMESTAMP)
		VALUES (Q_FOLLOWER_ID, Q_FOLLOWEE_ID, 'REQUESTED', CURRENT_TIMESTAMP);
	
	ELSIF UPPER(ACTION) = 'UNFOLLOW' OR UPPER(ACTION) =  'REMOVE-FOLLOW' THEN 
		DELETE FROM FOLLOWS WHERE FOLLOWER_ID = Q_FOLLOWER_ID AND FOLLOWEE_ID = Q_FOLLOWEE_ID;
		
	ELSIF UPPER(ACTION) = 'ACCEPT-FOLLOW' THEN
		UPDATE FOLLOWS
		SET STATUS = 'FOLLOWING'
		WHERE FOLLOWER_ID = FOLLOWER_ID AND FOLLOWEE_ID = FOLLOWEE_ID;
	
	ELSE
	
		RESULT := 'WRONG COMMAND';
		RETURN;
	
	END IF;
	
	
	
	RESULT := 'success';
	
EXCEPTION
   WHEN DUP_VAL_ON_INDEX THEN
       RESULT := 'ROW ALREADY EXISTS';
   WHEN OTHERS THEN
       RESULT := 'Something went wrong';
END;